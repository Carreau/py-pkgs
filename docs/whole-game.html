<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 The Whole Game | Python packages</title>
  <meta name="description" content="A simple and practical introduction to creating and distributing Python code via Python packages" />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 The Whole Game | Python packages" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A simple and practical introduction to creating and distributing Python code via Python packages" />
  <meta name="github-repo" content="ttimbers/py-pkgs" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 The Whole Game | Python packages" />
  
  <meta name="twitter:description" content="A simple and practical introduction to creating and distributing Python code via Python packages" />
  

<meta name="author" content="Tiffany Timbers &amp; Tomas Beuzen" />


<meta name="date" content="2020-02-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="setup.html"/>
<link rel="next" href="package-structure.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Python packages</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i><b>2</b> System setup</a><ul>
<li class="chapter" data-level="2.1" data-path="setup.html"><a href="setup.html#python-setup"><i class="fa fa-check"></i><b>2.1</b> Installing and updating Python</a></li>
<li class="chapter" data-level="2.2" data-path="setup.html"><a href="setup.html#register-for-a-pypi-account"><i class="fa fa-check"></i><b>2.2</b> Register for a PyPI account</a></li>
<li class="chapter" data-level="2.3" data-path="setup.html"><a href="setup.html#rstudio-python-setup"><i class="fa fa-check"></i><b>2.3</b> Setting up the RStudio IDE with Python</a><ul>
<li class="chapter" data-level="2.3.1" data-path="setup.html"><a href="setup.html#find-where-anaconda-is-installed-on-your-machine"><i class="fa fa-check"></i><b>2.3.1</b> Find where Anaconda is installed on your machine</a></li>
<li class="chapter" data-level="2.3.2" data-path="setup.html"><a href="setup.html#configuring-reticulate-for-to-use-the-python-repl-inside-rstudio"><i class="fa fa-check"></i><b>2.3.2</b> Configuring <code>reticulate</code> for to use the Python REPL inside RStudio</a></li>
<li class="chapter" data-level="2.3.3" data-path="setup.html"><a href="setup.html#configuring-the-rstudio-terminal"><i class="fa fa-check"></i><b>2.3.3</b> Configuring the RStudio terminal</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="setup.html"><a href="setup.html#alternative-python-ides"><i class="fa fa-check"></i><b>2.4</b> Alternative Python IDEs</a><ul>
<li class="chapter" data-level="2.4.1" data-path="setup.html"><a href="setup.html#pycharm"><i class="fa fa-check"></i><b>2.4.1</b> PyCharm</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="whole-game.html"><a href="whole-game.html"><i class="fa fa-check"></i><b>3</b> The Whole Game</a><ul>
<li class="chapter" data-level="3.1" data-path="whole-game.html"><a href="whole-game.html#poetry-to-create-project"><i class="fa fa-check"></i><b>3.1</b> Use Cookiecutter &amp; Poetry to create a Python project</a></li>
<li class="chapter" data-level="3.2" data-path="whole-game.html"><a href="whole-game.html#versio-control"><i class="fa fa-check"></i><b>3.2</b> Put your project under version control</a><ul>
<li class="chapter" data-level="3.2.1" data-path="whole-game.html"><a href="whole-game.html#set-up-local-version-control"><i class="fa fa-check"></i><b>3.2.1</b> Set-up local version control</a></li>
<li class="chapter" data-level="3.2.2" data-path="whole-game.html"><a href="whole-game.html#set-up-remote-version-control"><i class="fa fa-check"></i><b>3.2.2</b> Set-up remote version control</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="whole-game.html"><a href="whole-game.html#first-function"><i class="fa fa-check"></i><b>3.3</b> Write the first function</a></li>
<li class="chapter" data-level="3.4" data-path="whole-game.html"><a href="whole-game.html#test-drive-your-package-code"><i class="fa fa-check"></i><b>3.4</b> Test drive your package code</a></li>
<li class="chapter" data-level="3.5" data-path="whole-game.html"><a href="whole-game.html#pkg-func-deps"><i class="fa fa-check"></i><b>3.5</b> Add package function dependencies</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="package-structure.html"><a href="package-structure.html"><i class="fa fa-check"></i><b>4</b> Package structure and state</a><ul>
<li class="chapter" data-level="4.1" data-path="package-structure.html"><a href="package-structure.html#package-states"><i class="fa fa-check"></i><b>4.1</b> Package states</a></li>
<li class="chapter" data-level="4.2" data-path="package-structure.html"><a href="package-structure.html#modules"><i class="fa fa-check"></i><b>4.2</b> Modules</a></li>
<li class="chapter" data-level="4.3" data-path="package-structure.html"><a href="package-structure.html#source-packages"><i class="fa fa-check"></i><b>4.3</b> Source packages</a></li>
<li class="chapter" data-level="4.4" data-path="package-structure.html"><a href="package-structure.html#binary-packages"><i class="fa fa-check"></i><b>4.4</b> Binary packages</a></li>
<li class="chapter" data-level="4.5" data-path="package-structure.html"><a href="package-structure.html#installed-packages"><i class="fa fa-check"></i><b>4.5</b> Installed packages</a></li>
<li class="chapter" data-level="4.6" data-path="package-structure.html"><a href="package-structure.html#libraries"><i class="fa fa-check"></i><b>4.6</b> Libraries</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Python packages</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="whole-game" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> The Whole Game</h1>
<p>This chapter demonstrates how to develop an entire small toy Python package from beginning to end. It’s purpose it to motivate and give a high level overview of how a Python package can and should be developed. Later chapters will delve deeper into important package specifics. This chapter is a Pythonified version of <a href="https://r-pkgs.org/whole-game.html">the Whole Game chapter</a> written by Jenny Bryan that can be found in the the <a href="https://r-pkgs.org/">R packages book</a>.</p>
<div id="poetry-to-create-project" class="section level2">
<h2><span class="header-section-number">3.1</span> Use Cookiecutter &amp; Poetry to create a Python project</h2>
<p>So that we do not have to create a complicated file and directory structure ourselves, we will use Cookiecutter &amp; Poetry to do this for us! First we start with using Cookiecutter to create the project file and directory structure for our Python project (which will be a Python package). We will use a simplified version of the template base by the <a href="https://www.pyopensci.org/">PyOpenSci</a> organization designed specifically for creating Python packages. PyOpenSci is a not-for-profit organization that promotes open and reproducible research through peer-review of scientific Python packages.</p>
<p>To use Cookiecutter to set up the structure of your Python package, run the line of code below in the terminal from the directory where you would like your package to live.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="whole-game.html#cb6-1"></a>$ cookiecutter https:<span class="op">//</span>github.com<span class="op">/</span>UBC<span class="op">-</span>MDS<span class="op">/</span>cookiecutter<span class="op">-</span>ubc<span class="op">-</span>mds.git</span></code></pre></div>
<p>You will be prompted to provide information that will help customize the project. Here is a example of how to respond the the prompts:</p>
<pre><code>full_name [Audrey Roy Greenfeld]: Tiffany Timbers
email [audreyr@example.com]: tiffany.timbers@gmail.com
github_username [audreyr]: ttimbers
project_name [Python Boilerplate]: foocat
project_slug [foocat]: foocat
project_short_description [Python Boilerplate contains all the boilerplate you need to create a Python package.]: Python package that eases the pain concatenating Pandas categoricals!
pypi_username [ttimbers]: 
version [&#39;0.1.0&#39;]: 
Select open_source_license:
1 - MIT license
2 - BSD license
3 - ISC license
4 - Apache Software License 2.0
5 - GNU General Public License v3
Choose from 1, 2, 3, 4, 5 [1]: 1</code></pre>
<p>Next we navigate into the project directory we just created and initialize the project as a Poetry project so that we can take advantage of the package management and building tools provided by Poetry:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="whole-game.html#cb8-1"></a>$ cd foocat</span>
<span id="cb8-2"><a href="whole-game.html#cb8-2"></a>$ poetry init</span></code></pre></div>
<p>Again we are prompted for more information. We are provided with some suggestions for the information (which I think is gleaned from the Cookiecutter template that we just set up), and if we agree we can simply click enter at the prompt. Here is a example of how to respond the the prompts:</p>
<pre><code>This command will guide you through creating your pyproject.toml config.

Package name [foocat]:  
Version [0.1.0]:  
Description []:  Python package that eases the pain concatenating Pandas categoricals!
Author [ttimbers &lt;tiffany.timbers@stat.ubc.ca&gt;, n to skip]:  
License []:  MIT
Compatible Python versions [^3.7]:  

Would you like to define your main dependencies interactively? (yes/no) [yes] no
Would you like to define your dev dependencies (require-dev) interactively (yes/no) [yes] no
Generated file

[tool.poetry]
name = &quot;foocat&quot;
version = &quot;0.1.0&quot;
description = &quot;Python package that eases the pain concatenating Pandas categoricals!&quot;
authors = [&quot;ttimbers &lt;tiffany.timbers@stat.ubc.ca&gt;&quot;]
license = &quot;MIT&quot;

[tool.poetry.dependencies]
python = &quot;^3.7&quot;

[tool.poetry.dev-dependencies]

[build-system]
requires = [&quot;poetry&gt;=0.12&quot;]
build-backend = &quot;poetry.masonry.api&quot;


Do you confirm generation? (yes/no) [yes]</code></pre>
<p><em>Note - we said no to defining our dependencies interactively because it is more efficient to define them using <code>poetry add</code> at a later time point.</em></p>
<p>After using Cookiecutter and Poetry, we end up with the following directory structure:</p>
<pre><code>foocat
├── CONDUCT.md
├── CONTRIBUTING.md
├── CONTRIBUTORS.md
├── docs
│   └── conf.py
│   └── contributing.rst
│   └── contributors.rst
│   └── index.rst
│   └── installation.rst
│   └── Makefile
│   └── readme.rst
│   └── usage.rst
├── foocat
│   └── __init__.py
│   └── foocat.py
├── .github
│   └── workflows
│       └── build.yml
│       └── release.yml
├── .gitignore
├── LICENSE
├── pyproject.toml
└── tests
    ├── __init__.py
    └── test_foocat.py</code></pre>
<p>It gives us a boilerplate file and directory structure suitable for building a Python package. It indeed looks like a lot, however, at this point we need only to worry about a few of these files and directories to get a working package together, specifically a file for us to write out Python functions that our package will distribute (<code>foocat/foocat.py</code>), a home for our tests to ensure that our package functions work as we expect they should (<code>tests/test_foocat.py</code>), as well as a <code>pyproject.toml</code> file that we will use to define our project’s metadata and dependencies. We will focus on these in this chapter. Later chapters will focus on the rest, whose aim is to make your package one of high quality (in respect to documentation, continuous integration testing, and version bumping).</p>
<blockquote>
<p><strong>Optional for RStudio IDE users</strong>
Users of the RStudio IDE may also want to make this Python project directory an RStudio project. Why might you ask? Well, once you have an <code>*.Rproj</code> file, you can use that file to quickly open the RStudio IDE (which has a terminal and an interactive Python REPL, assuming you have set this up with <code>reticulate</code>) to the project’s root directory.</p>
</blockquote>
</div>
<div id="versio-control" class="section level2">
<h2><span class="header-section-number">3.2</span> Put your project under version control</h2>
<p>It is in our opinion that every data science project should put under local and remote version control. The tools we recommend using for this are Git &amp; GitHub. For this book, we assume Git is installed on their machine, have novice Git skills, and that users have a <a href="https://github.com/">GitHub.com</a> account.</p>
<div id="set-up-local-version-control" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Set-up local version control</h3>
<p>From the terminal and in the root of this project directory, initialize the repository to be tracked by Git:</p>
<pre><code>$ git init</code></pre>
<pre><code>Initialized empty Git repository in /Users/tiffany/Documents/ubc-mds/foocat/.git/</code></pre>
<p>Next, tell Git which files to track (all of them at this point) and commit these changes locally:</p>
<pre><code>$ git add .
$ git commit -m &quot;initial project set-up&quot;</code></pre>
<pre><code>[master (root-commit) ca03932] initial project set-up
 22 files changed, 798 insertions(+)
 create mode 100644 .github/workflows/build.yml
 create mode 100644 .github/workflows/release.yml
 create mode 100644 .gitignore
 create mode 100644 CONDUCT.md
 create mode 100755 CONTRIBUTING.md
 create mode 100755 CONTRIBUTORS.md
 create mode 100755 LICENSE
 create mode 100644 README.md
 create mode 100755 docs/Makefile
 create mode 100755 docs/conf.py
 create mode 100755 docs/contributing.rst
 create mode 100755 docs/contributors.rst
 create mode 100755 docs/index.rst
 create mode 100755 docs/installation.rst
 create mode 100755 docs/make.bat
 create mode 100755 docs/readme.rst
 create mode 100755 docs/usage.rst
 create mode 100644 foocat/__init__.py
 create mode 100644 foocat/foocat.py
 create mode 100644 pyproject.toml
 create mode 100644 tests/__init__.py
 create mode 100644 tests/test_foocat.py</code></pre>
</div>
<div id="set-up-remote-version-control" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Set-up remote version control</h3>
<p>Now that we have set up our local version control, let’s create a repository on <a href="https://github.com/">GitHub.com</a> and set that as the remote version control home for this project:</p>
<p><img src="img/set-up-github1.png"></p>
<p>The options we recommend for setting up a repository for a Python package using the workflow we present in this book include:</p>
<ul>
<li>give the GitHub.com repository the same name as your Python Poetry project’s name</li>
<li>make the GitHub.com repository public</li>
<li><strong>do not</strong> initialize the GitHub.com repository with a README</li>
</ul>
<p><img src="img/set-up-github2.png" ></p>
<p>Next, we set-up the remote address locally, and push our project to GitHub.com:</p>
<pre><code>$ git remote add origin git@github.com:ttimbers/foocat.git
$ git push -u origin master</code></pre>
<blockquote>
<p>Note: the example above uses SSH authentication with GitHub, HTTPS authentication works as well and would use this url in place of the one shown above to set the remote: <code>https://github.com/ttimbers/foocat.git</code>.</p>
</blockquote>
</div>
</div>
<div id="first-function" class="section level2">
<h2><span class="header-section-number">3.3</span> Write the first function</h2>
<p>Pandas categoricals are a very useful data type for modeling (and were inspired by R’s factors), but certain manipulations of this data type can be tricky in data wrangling. One such challenge is concatenation of Pandas categoricals. Let’s observe the result of trying to concatenate two Pandas categoricals objects:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="whole-game.html#cb16-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb16-2"><a href="whole-game.html#cb16-2"></a><span class="op">&gt;&gt;&gt;</span> a <span class="op">=</span> pd.Categorical([<span class="st">&quot;character&quot;</span>, <span class="st">&quot;hits&quot;</span>, <span class="st">&quot;your&quot;</span>, <span class="st">&quot;eyeballs&quot;</span>])</span>
<span id="cb16-3"><a href="whole-game.html#cb16-3"></a><span class="op">&gt;&gt;&gt;</span> b <span class="op">=</span> pd.Categorical([<span class="st">&quot;but&quot;</span>, <span class="st">&quot;integer&quot;</span>, <span class="st">&quot;where it&quot;</span>, <span class="st">&quot;counts&quot;</span>])</span>
<span id="cb16-4"><a href="whole-game.html#cb16-4"></a><span class="op">&gt;&gt;&gt;</span> pd.concat([a, b])</span></code></pre></div>
<pre><code>## Error in py_call_impl(callable, dots$args, dots$keywords): TypeError: cannot concatenate object of type &#39;&lt;class &#39;pandas.core.arrays.categorical.Categorical&#39;&gt;&#39;; only Series and DataFrame objs are valid</code></pre>
<p>This occurs because the categoricals are represented as integers in memory, and in <code>a</code> the integer 0 corresponds to the word “character” while in <code>b</code>, the integer 0 corresponds to the word “but”. Thus, when we ask Python to concatenate these two Pandas categorical options it doesn’t know what to do with these integer mappings to different categories, and so it throws an error. We can get around this several ways, one way is to convert the Pandas categoricals to a <code>str</code> type, then do the concatenation, and finally convert the concatenated Pandas obeject to a categorical again. We demonstrate that approach below:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="whole-game.html#cb18-1"></a><span class="op">&gt;&gt;&gt;</span> concatenated <span class="op">=</span> pd.concat([pd.Series(a.astype(<span class="st">&quot;str&quot;</span>)), pd.Series(b.astype(<span class="st">&quot;str&quot;</span>))])</span>
<span id="cb18-2"><a href="whole-game.html#cb18-2"></a><span class="op">&gt;&gt;&gt;</span> pd.Categorical(concatenated)</span></code></pre></div>
<pre><code>## [character, hits, your, eyeballs, but, integer, where it, counts]
## Categories (8, object): [but, character, counts, eyeballs, hits, integer, where it, your]</code></pre>
<p>That seems to work 🎉, but its quite a bit of typing every time we want to do this… Let’s turn this into a function called <code>catbind</code>!</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="whole-game.html#cb20-1"></a><span class="kw">def</span> catbind(a, b):</span>
<span id="cb20-2"><a href="whole-game.html#cb20-2"></a>  concatenated <span class="op">=</span> pd.concat([pd.Series(a.astype(<span class="st">&quot;str&quot;</span>)), pd.Series(b.astype(<span class="st">&quot;str&quot;</span>))])</span>
<span id="cb20-3"><a href="whole-game.html#cb20-3"></a>  <span class="cf">return</span> pd.Categorical(concatenated)</span>
<span id="cb20-4"><a href="whole-game.html#cb20-4"></a></span>
<span id="cb20-5"><a href="whole-game.html#cb20-5"></a>catbind(a, b)</span></code></pre></div>
<pre><code>## [character, hits, your, eyeballs, but, integer, where it, counts]
## Categories (8, object): [but, character, counts, eyeballs, hits, integer, where it, your]</code></pre>
<blockquote>
<p>Note - this book assumes you know how to write, document and test functions in Python. To learn more about this see <a href="http://greenteapress.com/thinkpython/html/thinkpython004.html">Think Python, Chapter 3: Functions</a> by Allen Downey.</p>
</blockquote>
<p>Where do we save this function if we want it to be a part of our foocat Python package? Let’s review the landscape of our Python project so far:</p>
<pre><code>foocat
├── CONDUCT.md
├── CONTRIBUTING.md
├── CONTRIBUTORS.md
├── docs
│   └── conf.py
│   └── contributing.rst
│   └── contributors.rst
│   └── index.rst
│   └── installation.rst
│   └── Makefile
│   └── readme.rst
│   └── usage.rst
├── foocat
│   └── __init__.py
│   └── foocat.py
├── .github
│   └── workflows
│       └── build.yml
│       └── release.yml
├── .gitignore
├── LICENSE
├── pyproject.toml
└── tests
    ├── __init__.py
    └── test_foocat.py</code></pre>
<p>All the code that we would like the user to run as part of our package should live inside the <code>foocat</code> directory. Typically, with a relatively small package with just a few functions, we would house them inside a single python script inside this directory. Our template project directory structure already created and named such a place for us, <code>foocat/foocat.py</code>. Let’s save our function there. Additionally, given that our package depends on the Pandas Python package, we should import Pandas at the top of the <code>foocat.py</code> file. Here’s what <code>foocat.py</code> should now look like:</p>
<pre><code>import pandas as pd


def catbind(a, b):
  concatenated = pd.concat([pd.Series(a.astype(&quot;str&quot;)), pd.Series(b.astype(&quot;str&quot;))])
  return pd.Categorical(concatenated)
</code></pre>
</div>
<div id="test-drive-your-package-code" class="section level2">
<h2><span class="header-section-number">3.4</span> Test drive your package code</h2>
<p>To test drive the function we just wrote we first install the package locally using Python poetry. We choose to do this with Python <code>poetry</code> as opposed to using <code>pip</code> because <code>poetry</code> automatically creates a virtual environment for us and will perform tricky tasks like package solving that can sometimes trip us up when we use pip alone.</p>
<pre><code>$ poetry install</code></pre>
<pre><code>Creating virtualenv foocat-z0_J6H1I-py3.7 in /Users/tiffany/Library/Caches/pypoetry/virtualenvs

Installing dependencies from lock file

No dependencies to install or update

  - Installing foocat (0.1.0)</code></pre>
<p>Now, inside this project directory, we can open an interactive Python session and import our function as shown:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="whole-game.html#cb26-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> foocat <span class="im">import</span> foocat</span></code></pre></div>
<p>By doing this we can access the the function in our Python session via <code>foocat.catbind</code>. Let’s now try to use this function to concatenate two Pandas categoricals:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="whole-game.html#cb27-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb27-2"><a href="whole-game.html#cb27-2"></a><span class="op">&gt;&gt;&gt;</span> a <span class="op">=</span> pd.Categorical([<span class="st">&quot;character&quot;</span>, <span class="st">&quot;hits&quot;</span>, <span class="st">&quot;your&quot;</span>, <span class="st">&quot;eyeballs&quot;</span>])</span>
<span id="cb27-3"><a href="whole-game.html#cb27-3"></a><span class="op">&gt;&gt;&gt;</span> b <span class="op">=</span> pd.Categorical([<span class="st">&quot;but&quot;</span>, <span class="st">&quot;integer&quot;</span>, <span class="st">&quot;where it&quot;</span>, <span class="st">&quot;counts&quot;</span>])</span>
<span id="cb27-4"><a href="whole-game.html#cb27-4"></a><span class="op">&gt;&gt;&gt;</span> foocat.catbind(a, b)</span></code></pre></div>
<pre><code>[character, hits, your, eyeballs, but, integer, where it, counts]
Categories (8, object): [but, character, counts, eyeballs, hits, integer, where it, your]</code></pre>
<p>Hurray again! This seems to work as expected!</p>
</div>
<div id="pkg-func-deps" class="section level2">
<h2><span class="header-section-number">3.5</span> Add package function dependencies</h2>
<p>Our function depends on the pandas package, and without it, it would fail to work. Thus we need to record this dependency in a useful place so that when we publish our pacakged code this important information (and the mechanism for making it work) will be shipped along with it. We again use <code>poetry</code> to do this, using the <code>add</code> command. This command will update the <code>[tool.poetry.dependencies]</code> section of the <code>pyproject.toml</code> file which currently looks like this and lists only Python as a project dependency:</p>
<pre><code>[tool.poetry]
name = &quot;foocat&quot;
version = &quot;0.1.0&quot;
description = &quot;Python package that eases the pain concatenating Pandas categoricals!&quot;
authors = [&quot;ttimbers &lt;tiffany.timbers@stat.ubc.ca&gt;&quot;]
license = &quot;MIT&quot;

[tool.poetry.dependencies]
python = &quot;^3.7&quot;

[tool.poetry.dev-dependencies]

[build-system]
requires = [&quot;poetry&gt;=0.12&quot;]
build-backend = &quot;poetry.masonry.api&quot;</code></pre>
<p>Let’s add our pandas dependency now:</p>
<pre><code>$ poetry add pandas</code></pre>
<pre><code>Using version ^1.0.1 for pandas

Updating dependencies
Resolving dependencies... (0.1s)

Writing lock file


Package operations: 4 installs, 1 update, 0 removals

  - Updating six (1.14.0 /usr/local/Cellar/poetry/1.0.3/libexec/vendor/lib/python3.7/site-packages -&gt; 1.14.0)
  - Installing numpy (1.18.1)
  - Installing python-dateutil (2.8.1)
  - Installing pytz (2019.3)
  - Installing pandas (1.0.1)</code></pre>
<p>Now if we view our <code>pyproject.toml</code> file we see that <code>pandas</code> is now listed as a dependency:</p>
<pre><code>[tool.poetry]
name = &quot;foocat&quot;
version = &quot;0.1.0&quot;
description = &quot;Python package that eases the pain concatenating Pandas categoricals!&quot;
authors = [&quot;ttimbers &lt;tiffany.timbers@stat.ubc.ca&gt;&quot;]
license = &quot;MIT&quot;

[tool.poetry.dependencies]
python = &quot;^3.7&quot;
pandas = &quot;^1.0.1&quot;

[tool.poetry.dev-dependencies]

[build-system]
requires = [&quot;poetry&gt;=0.12&quot;]
build-backend = &quot;poetry.masonry.api&quot;</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="setup.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="package-structure.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ttimbers/py-pkgs/edit/master/02-the-whole-game.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
